<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[직원용] 전자서명 대기명단</title>
    <link rel="stylesheet" href="/css/css@3.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/modals.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/sub.css">
    <link rel="stylesheet" href="/css/toast.css">
    <script defer src="/js/color-modes.js"></script>
    <script defer src="/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <style>
        .bi {
            vertical-align: -.125em;
            fill: currentColor;
        }
    </style>

    <script type="application/javascript" src="/js/common.js" defer></script>
    <script type="application/javascript" src="/js/staff/agree.js" defer></script>
</head>
<body>
<main class="wrap">
    <section class="header">
        <a class="home" href="/">
            <img src="/images/btn_home.png" alt="home">
        </a>
        <h1>[직원용] 화장 신고서 및 장사시설 사용 신청서</h1>
    </section>
    <section class="path_bar">
        <div class="path_box">
            <ul>
                <li>제 2024-25964호</li>
                <li>즉시처리</li>
            </ul>
            <p>
                <img src="/images/check_off.png" alt="off"> 를 클릭하여&nbsp;&nbsp;<img src="/images/check_on.png" alt="on">
                체크하시기 바랍니다.
            </p>
        </div>
    </section>
    <section class="page">
        <form action="">
            <h2>정보수집통의 <span>(필수동의)</span></h2>
            <ul class="information_box">
                <li>
                    <div class="information_box_contents">개인정보보호법 제 15조 1항(개인정보의 수집 이용)에 의거하여 본인의
                        개인정보를 화장업무 처리시 제공할 것을 동의합니다.
                    </div>
                    <div class="radio_items grid-auto">
                        <div class="radio_item">
                            <input type="checkbox" id="agree8-1" value="agree8-1" name="agree8-1" class="radioBtn" disabled/>
                            <label for="agree8-1">동의</label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="information_box_contents">「장사 등에 관한 법률」 제33조의 3제 3항 및 같은 법 시행규칙 제22조의
                        3에 따른 사망자정보 등록에 대한 사항에 동의합니다.
                        <p class="mt2">
                            <span class="text-red">※</span> 사망자정보 등의 제공을 거부할 경우 장사시설 이용이 제한될 수 있습니다.
                        </p>
                    </div>
                    <div class="radio_items grid-auto">
                        <div class="radio_item">
                            <input type="checkbox" id="agree8-2" value="agree8-2" name="agree8-2" class="radioBtn" disabled/>
                            <label for="agree8-2">동의</label>
                        </div>
                    </div>
                </li>
            </ul>
            <h2>제3자 위탁 제공동의 <span class="text-red">(선택동의)</span></h2>
            <ul class="information_box">
                <li>
                    <div class="information_box_contents">고객만족도 조사를 위하여 수집된 성명과 전화번호가 제3자의 위탁 제공할
                        것을 동의 합니다.
                    </div>
                    <div class="radio_items grid-auto">
                        <div class="radio_item">
                            <input type="checkbox" id="agree8-3" value="agree8-3" name="agree8-3" class="radioBtn" disabled/>
                            <label for="agree8-3">동의</label>
                        </div>
                    </div>
                </li>
            </ul>
            <p class="mb4">「장사 등에 관한 법률」 및 같은 법 시행규칙 따라 화장신고 및 「대구광역시 장사시설의 설치 및 운영
                조례」 및 같은 조례 시행규칙 제 2조의 규정에 의거 대구 명복공원 장사시설 사용을 신청합니다.</p>
            <p class="align-center mb4">사용신청일 2024년 03월 12일</p>
            <article class="sign_box mb4">
                <strong>성명: 김 인 재</strong>
                <a href="javascript:openSignModal();" class="sign_box_img">
                    (인)
                    <img id="signImage" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAR8AAABvCAYAAADVAsQ4AAAAAXNSR0IArs4c6QAAAxZJREFUeF7t1MEJAAAIAzG7/9KOcZ+4QCHI7RwBAgQCgQWbJgkQIHDi4wkIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBROAB880AcKYEo6kAAAAASUVORK5CYII=" alt="서명 또는 인">
                </a>
            </article>
            <h3>대구공공시설관리공단 이사장 귀하</h3>
            <table>
                <caption>화장일자 안내</caption>
                <tbody>
                <tr>
                    <th scope="row">화장일자</th>
                    <td>2024-03-12 3회차</td>
                    <th scope="row">관리번호</th>
                    <td>2024-254254-24</td>
                </tr>
                <tr>
                    <th scope="row">접수자</th>
                    <td rowspan="3">관리자12</td>
                </tr>
                </tbody>
            </table>
            <div class="btns">
                <a href="javascript:saveAgree();" class="btn">저장</a>
            </div>
        </form>
    </section>
</main>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">서명하기</h5>
                <button type="button" class="btn-reset" onclick="onClear();">다시쓰기</button>
                <button type="button" class="btn-close" onclick="signModal.hide();">닫기</button>
            </div>
            <div class="modal-body">
                <div class="sign_area">
                    <img id="modalSignImage" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAR8AAABvCAYAAADVAsQ4AAAAAXNSR0IArs4c6QAAAxZJREFUeF7t1MEJAAAIAzG7/9KOcZ+4QCHI7RwBAgQCgQWbJgkQIHDi4wkIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBREB8EnajBAiIjx8gQCAREJ+E3SgBAuLjBwgQSATEJ2E3SoCA+PgBAgQSAfFJ2I0SICA+foAAgURAfBJ2owQIiI8fIEAgERCfhN0oAQLi4wcIEEgExCdhN0qAgPj4AQIEEgHxSdiNEiAgPn6AAIFEQHwSdqMECIiPHyBAIBEQn4TdKAEC4uMHCBBIBMQnYTdKgID4+AECBBIB8UnYjRIgID5+gACBROAB880AcKYEo6kAAAAASUVORK5CYII=" width="287" height="111" style="position: relative;"/>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save" class="btn btn-primary" onclick="saveSign(true);">
                    서명하기
                </button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    let signModal;
    window.addEventListener("DOMContentLoaded", (event) => {
        signModal = new bootstrap.Modal(document.getElementById('exampleModal'), {
            keyboard: false,
        });
        document.getElementById('exampleModal').addEventListener('hide.bs.modal', (e) => {
            closeSignModal();
        });
    });

    function openSignModal() {
        fetch('/staff/terms/event', {
            method: 'POST',
            headers: {
                "Data-Type": "json",
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                id: 'signModal',
                value: 'open',
            }),
        })
            .then(response => {
                if (response.status === 204) {
                    signModal.show();
                }
            })
            .catch(error => {
                console.log(error);
            });
    }

    function closeSignModal() {
        fetch('/staff/terms/event', {
            method: 'POST',
            headers: {
                "Data-Type": "json",
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                id: 'signModal',
                value: 'close',
            }),
        })
            .then(response => {
                if (response.status === 204) {
                    signModal.hide();
                }
            })
            .catch(error => {
                console.log(error);
            });
    }

    function onClear() {
        fetch('/staff/terms/event', {
            method: 'POST',
            headers: {
                "Data-Type": "json",
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                id: 'signModal',
                value: 'clear',
            }),
        })
            .catch(error => {
                console.log(error);
            });
    }

    function saveSign(isSendServer) {
        const modalSignImage = document.getElementById('modalSignImage');
        const signImage = document.getElementById('signImage');
        signImage.src = modalSignImage.src;
        closeSignModal();
        if (isSendServer) {
            fetch('/staff/terms/event', {
                method: 'POST',
                headers: {
                    "Data-Type": "json",
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    id: 'signModal',
                    value: 'save',
                }),
            })
                .then(response => {
                    if (response.status === 204) {
                        signModal.hide();
                    }
                })
                .catch(error => {
                    console.log(error);
                });
        }
    }

    function saveAgree() {
        const check1 = document.getElementById('agree8-1');
        const check2 = document.getElementById('agree8-2');
        const signImage = document.getElementById('signImage');

        if (!check1.checked || !check2.checked) {
            showToast('필수 항목을 동의해 주세요.');
            if (!check1.checked) {
                check1.focus();
                return;
            }
            if (!check2.checked) {
                check2.focus();
                return;
            }
            return;
        }

        if (calByte.getByteLength(signImage.src) < 1200) {
            showToast('서명란을 클릭하여 서명해 주세요.');
            return;
        }

        fetch('/staff/terms/event', {
            method: 'POST',
            headers: {
                "Data-Type": "json",
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                id: 'saveAgree',
            }),
        })
            .catch(error => {
                console.log(error);
            });
    }
</script>

<div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2"
     tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                김인재님<br/>사용 신청 완료되었습니다.
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-bs-toggle="modal">확인</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
